var i=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var u=i((A,y)=>{var{Sequelize:z}=require("sequelize"),E=new z("hrman","root","admin",{dialect:"mysql",host:"localhost"});y.exports=E});var g=i((K,q)=>{var{Sequelize:n}=require("sequelize"),R=u(),v=R.define("employee",{id:{type:n.INTEGER,autoIncrement:!0,allowNull:!1,primaryKey:!0},firstName:{type:n.STRING,allowNull:!1},lastName:{type:n.STRING,allowNull:!1},email:{type:n.STRING,allowNull:!1}});q.exports=v});var w=i((O,S)=>{var N=require("multer"),h=require("path"),D=require("fs-extra"),I=N.diskStorage({destination:function(t,e,s){s(null,h.join("uploads"))},filename:function(t,e,s){let l=e.originalname.split(" ").join("_");s(null,`${Date.now()}_${l}`)}}),T=N({storage:I,limits:{fileSize:9e6},fileFilter(t,e,s){e.originalname.match(/.csv$/i)||(D.emptyDirSync(h.join("uploads")),s(new Error("File type not allowed."))),s(null,!0)}}),U=T.single("csvFile");S.exports=U});var j=i((P,x)=>{var c=require("express").Router(),m=require("fs-extra"),p=require("path"),b=require("fast-csv"),G=require("validator"),d=g(),k=w();c.get("/api/employees",async(t,e)=>{try{let s=await d.findAll();e.send(s)}catch(s){e.send(s)}});c.post("/api/employees",async(t,e)=>{try{let{firstName:s,lastName:l,email:o}=t.body,a=await d.create({firstName:s,lastName:l,email:o});e.send(a)}catch(s){console.log(s)}});c.post("/api/upload",k,async(t,e)=>{try{let s=[],l=b.parse({ignoreEmpty:!0,discardUnmappedColumns:!0,headers:["firstName","lastName","email"]});m.createReadStream(p.join("uploads",t.file.filename)).pipe(l).on("error",o=>{console.error(o)}).on("data",o=>{let a={firstName:o.firstName.trim(),lastName:o.lastName.trim(),email:o.email.trim()};a.firstName!==""&&a.lastName!==""&&a.email!==""&&G.isEmail(a.email)&&s.push(a)}).on("end",()=>{d.bulkCreate(s).then(()=>{let o={status:"ok",filename:t.file.originalname,message:"Upload Successfully!"};e.json(o)}),m.emptyDirSync(p.join("uploads"))})}catch(s){m.emptyDirSync(p.join("uploads"));let l={status:"fail",filename:t.file.originalname,message:"Upload Error! message = "+s.message};e.json(l)}});x.exports=c});var f=require("express"),F=require("cors"),$=u();$.sync().then(t=>console.log("Database connected!")).catch(t=>console.log(t));var r=f();r.use(F());r.use(f.json());r.use(f.urlencoded({extended:!1}));r.get("/",(t,e)=>{e.send("home")});r.use(j());var C=process.env.PORT||3001;r.listen(C,()=>console.log("http://localhost:3001"));
